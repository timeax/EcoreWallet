import{r as f,j as V}from"./app-CXhxP4IC.js";import{i as o}from"./index-uIOWaCi_.js";o.enableBoundaryChecking(!1);const R=f.createContext();function at(){return f.useContext(R)}function W(b,m){return m.forEach(p=>{}),b=="1d"?m.map(p=>({x:p[0],y:p[1]})):m.map(p=>({x:p[0],y:p[1]}))}const X=({range:b="1d",historicalData:m,marketData:p,rates:k,children:A,historicalId:N,currencies:r,wallets:S})=>{const[T,_]=f.useState(),[D,j]=f.useState([]),[c,F]=f.useState([]),[Y,L]=f.useState(),[l,U]=f.useState(),[x,B]=f.useState(N),[h,v]=f.useState(b),[H,J]=f.useState(),y="defaultCurrency";f.useEffect(()=>{h||v(b||"1d");const t=window.localStorage.getItem(y)||"";C(t)},[]),f.useEffect(()=>{m&&h&&x&&window.axios.get(route("data.historical",{id:x,range:h})).then(t=>{var e;if(t.status==200){if(!Array.isArray(t.data))return;const a=(e=t.data[0])==null?void 0:e.currency_id;if(!a)return;const n=t.data.map(i=>JSON.parse(i.data).prices),d={id:a,data:W(h,n.flat())};_(d)}})},[x,h]);function E(t){const e={get data(){return this.wallets.length===0?null:this.wallets.reduce((a,n)=>({available:o.round(o.plus(n.available,a.available),3),id:n.id,pending:o.round(o.plus(n.pending,a.pending),3),total:o.round(o.plus(n.total,a.total),3)}))},wallets:[]};S.forEach(a=>{let{id:n,code:d}=a.curr,i=t.find(u=>u.id==n),s;if(i&&(s=i.data.find(g=>g.to===(l==null?void 0:l.code))||i.data.find(g=>g.to===((l==null?void 0:l.code)||"USD"))),s){const{total:u,available:g,escrow:z}=a.all_balance,G=o.round(o.times(u,s.course),8),K=o.round(o.times(g,s.course),8),Q=o.round(o.times(z,s.course),8);e.wallets.push({available:K,total:G,pending:Q,id:a.id})}}),e.wallets&&J(e)}function w(t){window.axios.get(route("data.market")).then(e=>{if(e.status===200){let a=null;if(Array.isArray(e.data)){const n=e.data.map((d,i)=>(t||i==0&&(a=new Date(d.updated_at).getTime()),{id:d.currency_id,data:JSON.parse(d.data)}));if(j(n),a){let u=15-(Date.now()-a)/600,g=15*6e4;u>0?setTimeout(()=>w(),u*6e4):(w(!0),u*=-1,setTimeout(()=>w(),g-(u+6e4)))}}}})}function M(){window.axios.get(route("data.rates")).then(t=>{if(t.status==200){if(!Array.isArray(t.data))return;const e=t.data.map(a=>{let n=JSON.parse(a.rates);return{id:a.currency_id,data:n}});F(e)}}).catch(t=>{})}f.useEffect(()=>{if(k||S){c&&E(c);const t=setInterval(()=>M(),5e3);return()=>clearInterval(t)}},[c]);const O=5e3*60;f.useEffect(()=>{if(p&&r){D.length===0&&w();const t=setInterval(()=>w(D.length>0),O);return()=>clearInterval(t)}},[D]),f.useEffect(()=>{l&&(L(l==null?void 0:l.code),c&&E(c))},[l]);const P=(t,e=(a=>(a=r.find(n=>n.default==1))==null?void 0:a.code)()||(l==null?void 0:l.code)||"USD")=>{var d;let n=r==null?void 0:r.find(i=>typeof t=="number"?i.id===t+"":i.code==t);if(n){if(c)return(d=c.find(s=>s.id==n.id))==null?void 0:d.data.find(s=>s.to==e)}else throw Error("Conversion Failed")},I=(t,e,a=0)=>{var d;let n=r==null?void 0:r.find(i=>typeof t=="number"?i.id===t+"":i.code==t);if(n){if(c){const i=(d=c.find(s=>s.id==n.id))==null?void 0:d.data.find(s=>s.to==e);if(i){const s=o.round(i.course,8);if(a==0)return s;let u=o.times(o.divide(a,100),s);return o.round(o.minus(s,u),8)}}}else throw Error("Conversion Failed");return 0},$=(t,e,a,n=8,d=0)=>{const i=I(t,e,d);return i?o.round(o.times(i,a),n):o.round(a,n)},q=(t,e,a=8)=>o.round(o.times(e,t),a),C=t=>{var e;typeof t=="object"?e=t:Number.isNaN(parseInt(t))?e=r==null?void 0:r.find(a=>a.code==t):t?e=r==null?void 0:r.find(a=>a.id==t):e=r.find(a=>a.default==1),e&&U(e),window.localStorage.setItem(y,(e==null?void 0:e.code)||"USD")};return V.jsx(R.Provider,{value:{rates:c,marketData:D,historicalData:T,setHistoricalId:t=>B(t),setHistoricalRange:t=>v(t),change:q,currencies:r,range:h,currency:l,balance:H,convert:$,getRate:I,setCurr:C,wallets:S,currRate:P},children:A})},et=X;export{et as L,at as u};
