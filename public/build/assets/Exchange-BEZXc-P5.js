import{r as i,j as e,c as M,W as de}from"./app-CXhxP4IC.js";import{T as U,s as S,i as N}from"./index-uIOWaCi_.js";import{B as K}from"./index-BWw7OOr8.js";import{C as X}from"./CryptoIcon-BdaG5iW0.js";import{T as x}from"./index-ByMu0qn2.js";import{T as Y}from"./index-Cur7t6HG.js";import{s as Q}from"./trade-input.module-DA5BFW74.js";import{e as fe,f as xe,g as he,h as pe}from"./index-SyAJMH_1.js";import{u as je,L as ve}from"./LiveContext-DcvojEoZ.js";import{D as ie,T as ge}from"./index-DDdEYXzY.js";import{T as be,C as Ne}from"./index-Brqb9oXI.js";import{I as we}from"./IconButton-3auqLRD5.js";import{u as ye,A as Se}from"./AuthenticatedLayout-MNU11-dO.js";import{F as le,a as Ce}from"./index-CRiK872-.js";import{S as Pe}from"./Select-C-exctFT.js";import{M as te}from"./message.esm-GcpnwvdI.js";import{T as Fe,a as re}from"./tabview.esm-C7_PWlvx.js";import{s as se}from"./trade.module-DNpBJkAs.js";import"./StyledButton-DM_a2VOH.js";import"./index-CGiUeyTh.js";import"./iconBase-DWzPX-n0.js";import"./tooltip.esm-A3nGpM54.js";import"./index.esm-CrCcFfvx.js";import"./objectWithoutPropertiesLoose-BwfzGx52.js";import"./iconbase.esm-Cq4ooEvg.js";import"./ripple.esm-CLCo6fDN.js";import"./inputtext.esm-GbgemPKy.js";import"./index-DdMq2KMe.js";import"./index.esm-DVhXXx0K.js";import"./index.esm-BrhfK6k7.js";import"./Dropdown-XGO5mqUA.js";import"./index.esm-CPBasDD3.js";const ne=i.createContext();function G(){return i.useContext(ne)}const ae=({children:n,wallets:o,...r})=>{const[s,c]=i.useState({from:{converted:0,input:""},limit:{converted:0,input:""},to:{converted:0,input:""},time:{converted:0,input:""}}),[b,u]=i.useState({from:{fiat:{symbol:"$",rate:0},rate:0},to:{fiat:{symbol:"$",rate:0},rate:0}}),[j,a]=i.useState({from:o.from,to:o.to}),{getRate:v,rates:C}=je();i.useEffect(()=>{b&&u(E.getRate("from","to"))},[C,j]);const E={getKey(t){return t=="from"?"to":"from"},getField(t){return s[t]},setField(t,p){c(f=>{if(t=="from"||t=="to"){for(const g in f)if(Object.prototype.hasOwnProperty.call(f,g)){const h=f[g];h.current=!1}}return{...f,[t]:{...f[t],[t=="time"?"timer":"input"]:p,current:!0}}})},setWallet(t,p){a(f=>({...f,[t]:p}))},convert(t,p){c(f=>({...f,[t]:{...f[t],converted:p}}))},getRate(...t){let p={},f=r.list.currencies.find(g=>g.default==1);return t.forEach(g=>{let h=g=="from"?"to":"from";p={...p,[g]:{fiat:{symbol:f.symbol,rate:v(j[g].curr.code,f.code)},rate:v(j[g].curr.code,j[h].curr.code)}}}),p},getCurrent(){return s.from.current?{...s.from,id:"from"}:s.limit.current?{...s.from,id:"from"}:s.to.current?{...s.to,id:"to"}:{...s.from,id:"from"}},snap(){return{amount:s.from.converted,toAmount:s.to.converted,limit:s.limit.converted||parseFloat(s.limit.input||"0"),rates:E.getRate("from","to"),expire:s.time.timer}}};return e.jsx(ne.Provider,{value:{...r,...E,wallets:j,rates:b,fields:s},children:n})},Z=({value:n=0,elementRef:o,className:r="",error:s="",min:c=1e-8,max:b=1e5,currencies:u,sx:j,id:a,wallet:v,limit:C})=>{const{list:E,setWallet:t,wallets:p,getKey:f,setField:g,fields:h,rates:L,convert:W,getCurrent:B,type:H,getField:I}=G(),[R,P]=i.useState(s),[A,D]=i.useState(n),[V,$]=i.useState(!0),m=o||i.useRef(),w=i.useRef(),_=a==="limit",F=f(v),[O,k]=i.useState(p[v]);i.useEffect(()=>{k(O)},[p]);function q(d,l=!1){const{rate:y}=L[F],{fiat:J}=L[v];if(w.current&&(w.current.innerText=J.symbol+N.round(N.times(J.rate,d),2)),l)return H==="limit"?_?void 0:C?N.round(N.times(h.limit.input||0,d),8):N.round(N.divide(N.times(1,h[F].converted),h.limit.input||h.limit.converted),8):N.round(N.times(y,d),8)}function ee(){const d=N.minus(L[F].rate,9e-7);D(d),g(a,d||0)}i.useEffect(()=>{a==="limit"&&ee()},[]),i.useEffect(()=>{const d=B();if(a!=="limit"&&q(A),d.id===a)return;if(a=="limit")return h.limit.converted?void 0:ee();const l=h[F],y=q(l.converted,!0);typeof y=="number"&&(W(a,y),D(y))},[L]),i.useEffect(()=>{_&&(A>L.to.rate?P("The price you set to buy is higher than the current market price, which results in a loss."):P(""))},[h.limit]),i.useEffect(()=>{const d=B();if(a=="limit")d.id==a&&g("from",I("from").converted);else if(a!==d.id){let l=h[F].input,y=q(l,!0);if(typeof y!="number")return;W(a,y),D(y)}},[h[F].input]),i.useEffect(()=>{if(a=="from"){const d=p.from.all_balance.available,l=I("from").converted;!(l<c||l>b||l>d)&&R?P(""):h.from.input||h.to.input?(l<c&&P(`Amount is less than the minimum amount (${c})`),l>b&&P(`Amount is more than the maximum amount (${b})`),l>d&&P("Amount is more than current funds")):P("")}},[h.from.converted]);const ue=d=>{let l=d.target.value.trim();l=="."?l="0.":l.startsWith("0")?l.length>1&&(l.charAt(1)==="0"?l="0":l.charAt(1)!=="."&&(l=l.substring(1))):l.startsWith("-")?l="0":l.startsWith(".")&&(l="0"+l),D(l||""),q(l),g(a,l||0),W(a,l)};function me(d){const l=E.wallets.find(y=>y.curr.id==d.id);k(l),t(v,l)}return e.jsxs(U,{sx:j,className:M("relative",r),children:[e.jsx("div",{ref:m,className:M(Q.main,{"!border-danger-300":R,"!p-0 !border-none":_}),children:e.jsxs(e.Fragment,{children:[e.jsx("input",{step:"any",value:Number.isNaN(A)?0:A,placeholder:"0",onChange:ue,onBlur:()=>{var d;return(d=m.current)==null?void 0:d.classList.remove(Q.focused)},onFocus:()=>{var d;(d=m.current)==null||d.classList.add(Q.focused)},type:"number"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs(Y,{onClick:()=>$(!1),size:"16px",className:"!font-medium !flex items-center gap-1 "+(u?"cursor-pointer":""),children:[e.jsx("span",{children:p[v].curr.code})," ",u?e.jsx(fe,{}):""]}),e.jsxs("div",{className:"flex justify-between items-center w-full py-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:S(!_,e.jsxs(x,{noPad:!0,bright:!0,className:"gap-1",children:[e.jsx(be,{fontSize:"11px"}),e.jsx(x,{noPad:!0,bright:!0,sm:!0,ref:w,children:"$0.00"})]}),e.jsxs(x,{noPad:!0,sm:!0,className:"gap-1",children:["Market Price:",e.jsxs(x,{noPad:!0,sm:!0,children:[L[F].rate," ",p[v].curr.code]})]}))}),S(!_,e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(x,{noPad:!0,children:"Balance:"}),e.jsx(x,{noPad:!0,medium:!0,children:N.round(O.all_balance.available||0,8)}),e.jsx(x,{noPad:!0,medium:!0,sm:!0,children:O.curr.code})]}))]}),u?e.jsx(Te,{set:$,value:O,hide:V,list:u,onChange:me}):""]}),S(C,e.jsxs("div",{className:"flex flex-col mt-3 gap-3",children:[e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(x,{md:!0,medium:!0,noPad:!0,className:"gap-1",children:["When 1 ",e.jsx("b",{children:p[f(v)].curr.code})," is worth"]}),e.jsx(Z,{value:0,elementRef:m,id:"limit",wallet:v})]})]}))]})}),e.jsx(Y,{className:"text-danger-700 !font-medium",variant:"small",children:R})]})},Te=({list:n,onChange:o,hide:r,set:s})=>{const[c,b]=i.useState(n);return e.jsx(ie,{header:"Select Currency",className:Q.currencyList,visible:!r,style:{height:"60vh"},onHide:()=>{r||s(!0)},children:e.jsxs("div",{className:"m-0",children:[e.jsx(ge,{placeholder:"Search",onChange:u=>{const j=(u.target.value||"").toLowerCase();if(j.trim()=="")return b(n);b(n.filter(a=>a.code.toLowerCase().includes(j)||a.curr_name.toLowerCase().includes(j)))}}),e.jsx("div",{className:"mt-4 flex flex-col",children:c.map(u=>e.jsxs("div",{className:"flex px-3 py-2 rounded-md hover:bg-theme-button cursor-pointer items-center",onClick:()=>{s(!0),o(u)},children:[e.jsxs("div",{className:"flex gap-2 items-center mr-auto",children:[e.jsx(X,{height:"30px",width:"30px",size:"11px",name:u.curr_name,label:u.symbol}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(x,{bold:!0,noPad:!0,children:u.code}),e.jsx(x,{noPad:!0,children:u.curr_name})]})]}),e.jsx(we,{variant:"none",children:e.jsx(xe,{})})]},u.id))})]})})},oe=({order:n,exchange:o,title:r})=>{var a,v;const{list:s,wallets:c,type:b,rates:u}=G(),j=ye();return i.useEffect(()=>{c.to.id==c.from.id&&j({closable:!0,severity:"error",summary:`Cannot exchange ${c.from.curr.code} with ${c.to.curr.code}`})},[c]),e.jsxs("div",{className:"flex flex-col relative gap-2",children:[e.jsx(Y,{size:"15px",className:"!font-medium",color:"rgb(var(--color-theme-emphasis))",children:r||"Amount"}),e.jsxs("div",{className:"flex relative flex-col gap-2",children:[e.jsx(Z,{sx:{order:n==-1?1:0},currencies:s.currencies,id:"from",wallet:"from",limit:b==="limit"}),e.jsx(U,{order:n==-1?0:1,className:"h-full relative w-full flex",children:e.jsx(U,{sx:{width:"45px",height:"45px",fontSize:"30px",zIndex:99,margin:"auto"},className:"flex text-theme/55 items-center justify-center",children:S(o,e.jsx(Ne,{}),e.jsx(he,{}))})}),e.jsx(Z,{sx:{order:n==-1?n:2},currencies:s.currencies,id:"to",wallet:"to"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{noPad:!0,lg:!0,bold:!0,bright:!0,className:"flex gap-1",children:" Rate"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(x,{noPad:!0,children:["1 ",(a=c.from)==null?void 0:a.curr.code]}),e.jsx(le,{}),e.jsxs(x,{bold:!0,noPad:!0,children:[" ",u&&u.from.rate," ",(v=c.to)==null?void 0:v.curr.code]})]})]})]})},ut=({auth:n,wallet:o,wallets:r,currencies:s})=>e.jsx(Se,{user:n.user,title:"Swap",pusher:!0,desc:"Perform Fase and Seamless exchange",children:e.jsx(ve,{wallets:r,currencies:s,rates:!0,children:e.jsx("div",{className:M("mt-8",se.mainSwap),children:e.jsx("div",{className:se.swap,children:e.jsxs(Fe,{children:[e.jsxs(re,{header:"Market",children:[e.jsx("div",{className:"mt-4"}),e.jsx(Ee,{auth:n,wallet:o,wallets:r,currencies:s})]}),e.jsxs(re,{header:"Limit",children:[e.jsx("div",{className:"mt-4"}),e.jsx(Le,{auth:n,wallet:o,wallets:r,currencies:s})]})]})})})})}),Ee=({wallet:n,wallets:o,auth:r,currencies:s})=>{const[c,b]=i.useState(n),[u,j]=i.useState(o.find(a=>a.id!==c.id));return e.jsx(ae,{user:r.user,type:"instant",wallets:{from:c,to:u},list:{currencies:s,wallets:o},children:e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(oe,{exchange:!0,onChange:a=>console.log(a),order:0}),e.jsx(ce,{type:"instant"})]})})})},ce=({type:n})=>{var V,$;const{fields:o,wallets:r,snap:s}=G(),[c,b]=i.useState(!0),[u,j]=i.useState(0),[a,v]=i.useState(0),[C,E]=i.useState(!1),[t,p]=i.useState(),[f,g]=i.useState(!0),[h,L]=i.useState(6),{setData:W,processing:B,post:H,errors:I}=de({});function R(m){var w;W({from:r.from.curr.id,to:r.to.curr.id,amount:m==null?void 0:m.amount,expire:(w=m==null?void 0:m.expire)==null?void 0:w.label,limitRate:m==null?void 0:m.limit,rate:m==null?void 0:m.rates.from.rate,type:n}),p(m)}i.useEffect(()=>{b(o.from.converted<=0||o.to.converted<=0)},[o.from.converted,o.to.converted]);const[P,A]=i.useState(),D=()=>{clearInterval(P),L(6)};return i.useEffect(()=>{D(),E(!f)},[f]),i.useEffect(()=>{if(C){P&&D();const m=r.from;if(!f){let w=parseFloat(m.curr.charges.exchange_charge);Number.isNaN(w)&&(w=0),m.curr.charges.exchange_charge_type=="%"&&(w=N.times((t==null?void 0:t.amount)||0,N.divide(w,100))),v(w),j(N.plus((t==null?void 0:t.amount)||0,w)),A(setInterval(()=>{L(F=>(F==1&&E(!1),F-1))},1e3))}}},[C]),i.useEffect(()=>{h===-2&&(D(),R(s()),E(!0))},[h]),i.useEffect(()=>{console.log(I)},[B]),e.jsxs(e.Fragment,{children:[e.jsx(K,{type:"button",onClick:()=>{g(!1),R(s())},className:M({"opacity-50 cursor-not-allowed":c}),disabled:c,centered:!0,children:o.from.converted>0||o.to.converted>0?"Preview Conversion":"Enter an amount"}),e.jsx(ie,{header:"Confirm",visible:!f,style:{width:"30vw",height:"fit-content"},onHide:()=>{f||g(!0)},children:e.jsxs("div",{className:"m-0 flex flex-col gap-7",children:[e.jsxs("div",{className:"flex gap-3 flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(X,{height:"25px",width:"25px",size:"12px",name:r.from.curr.curr_name,label:r.from.curr.symbol}),e.jsx(x,{bold:!0,noPad:!0,lg:!0,children:t==null?void 0:t.amount})]}),e.jsx(x,{noPad:!0,lg:!0,children:r.from.curr.code})]}),e.jsx(Ce,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(X,{height:"25px",width:"25px",size:"10px",name:r.to.curr.curr_name,label:r.to.curr.symbol}),e.jsx(x,{bold:!0,noPad:!0,lg:!0,children:t==null?void 0:t.toAmount})]}),e.jsx(x,{noPad:!0,lg:!0,children:r.to.curr.code})]})]}),e.jsxs("div",{children:[S(n=="limit",e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Expires in",value:e.jsx(T,{children:e.jsx(T,{children:(V=t==null?void 0:t.expire)==null?void 0:V.label})})}),e.jsx(z,{label:"Limit Rate",value:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(T,{children:["1 ",r.to.curr.code]}),"=",e.jsxs(T,{children:[t==null?void 0:t.limit," ",r.from.curr.code]})]})})]}),e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Rate",value:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(T,{children:["1 ",r.to.curr.code]}),"=",e.jsxs(T,{children:[($=t==null?void 0:t.rates)==null?void 0:$.to.rate," ",r.from.curr.code]})]})}),e.jsx(z,{label:"inverse Rate",value:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(T,{children:["1 ",r.from.curr.code]}),"=",e.jsxs(T,{children:[t==null?void 0:t.rates.from.rate," ",r.to.curr.code]})]})})]})),e.jsx(z,{label:`Transaction Fees (${r.from.curr.charges.exchange_charge_type||"%"})`,value:e.jsx(T,{children:S(a>0,e.jsxs("span",{className:"flex gap-2 items-center",children:[e.jsx("b",{children:r.from.curr.charges.exchange_charge})," ",e.jsx(le,{})," ",e.jsx("span",{children:a})]}),"No Fees")})}),S(n=="instant",e.jsx(z,{label:"Total",value:e.jsx(T,{children:u})}))]}),S(n=="instant",e.jsx("div",{className:"flex flex-col gap-2",children:S(parseFloat(r.from.all_balance.available)>=u,e.jsx(K,{disabled:!C,centered:!0,size:"normal",className:M({"opacity-60":!C}),onClick:m=>{m.preventDefault(),H(route("user.crypto.process.swap"))},bgColor:"primary",children:S(C,e.jsxs(e.Fragment,{children:["Convert ",h,"s"]}),"Refreshing...")}),e.jsxs("div",{className:"flex flex-col gap-2 !justify-start",children:[e.jsx(te,{className:"text-[13px]",text:"Insufficient balance. Please fund your account.",severity:"error"}),e.jsx(K,{onClick:()=>p(s()),centered:!0,size:"normal",bgColor:"secondary",children:"Refresh Quote"})]}))})),S(n=="limit",e.jsx("div",{className:"flex flex-col gap-2",children:S(parseFloat(r.from.all_balance.available)>=u,e.jsx(K,{centered:!0,size:"normal",onClick:m=>{m.preventDefault(),H(route("user.crypto.process.swap"))},bgColor:"primary",children:"Ok"}),e.jsx("div",{className:"flex flex-col gap-2 !justify-start",children:e.jsx(te,{className:"text-[13px]",text:"Insufficient balance. Please fund your account.",severity:"error"})}))}))]})})]})},z=({value:n,label:o})=>e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx(x,{md:!0,bright:!0,noPad:!0,children:o}),e.jsx("div",{className:"flex justify-end",children:n})]}),T=({children:n})=>e.jsx(x,{bold:!0,noPad:!0,children:n}),Le=({wallet:n,wallets:o,auth:r,currencies:s})=>{const[c,b]=i.useState(n),[u,j]=i.useState(o.find(a=>a.id!==c.id));return e.jsx(ae,{user:r.user,type:"limit",wallets:{from:c,to:u},list:{currencies:s,wallets:o},children:e.jsxs("form",{className:"flex flex-col",children:[e.jsx(De,{}),e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(oe,{exchange:!0,onChange:a=>console.log(a),order:0}),e.jsx(ce,{type:"limit"})]})]})})},De=()=>{const{setField:n}=G(),o={value:"30d",label:"30 Days"},r=[{value:"1h",label:"1 Hour"},{value:"1d",label:"1 Day"},{value:"3d",label:"3 Days"},{value:"7d",label:"1 Days"},o];return i.useEffect(()=>{n("time",o)},[]),e.jsx(Pe,{className:"!bg-transparent !w-[130px] mb-2 ml-auto",trigger:"!h-[30px] !w-[30px] items-center flex !p-0 ml-2 hide-label",items:r,unique:"label",value:{value:"30d",label:"30 Days"},placeholder:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(pe,{})," ",e.jsx(x,{noPad:!0,children:"Expires in"})]}),contentTemplate:s=>e.jsx(x,{noPad:!0,children:s.label}),menuItemTemplate:s=>e.jsx(x,{noPad:!0,children:s.label}),quick:!0,onSelect:s=>{const c=s.value;n("time",c)}})};export{ut as default};
