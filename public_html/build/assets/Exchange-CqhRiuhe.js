import{r as i,j as e,c as H,W as fe}from"./app-DPeqRPcX.js";import{a as Y,T as x,s as C,i as w,k as ie}from"./index-BtqGtben.js";import{B as K}from"./index-BuV88OsN.js";import{C as Q}from"./CryptoIcon-C9dw8rPY.js";import{s as I}from"./trade-input.module-BqZ4cehw.js";import{g as xe,h as he,i as pe,j as je}from"./index-DOPl3nEV.js";import{u as ge,L as ve}from"./LiveContext-C6thlj0u.js";import{D as le}from"./dialog.esm-B90dCpDH.js";import{T as be,C as Ne}from"./index-DAW83uBr.js";import{T as we}from"./index-Dfq4-ipG.js";import{I as ye}from"./IconButton-lyUs3Fyy.js";import{u as Ce}from"./AuthenticatedContext-YAhfpYvk.js";import{a as ne,b as Se}from"./index-euvBnKB1.js";import{S as Pe}from"./Select-CJRs8Qvl.js";import{A as Fe}from"./AuthenticatedLayout-BfKv6hjQ.js";import{M as re}from"./message.esm-D0JP2ibE.js";import{T as Te,a as te}from"./tabview.esm-CgPeHz0w.js";import{s as se}from"./trade.module-J6tOawwr.js";import"./StyledButton-ciDqVOpa.js";import"./iconBase-BE7iW8MJ.js";import"./componentbase.esm-CEyx904k.js";import"./index.esm-UiDtkRAd.js";import"./objectWithoutPropertiesLoose-BwfzGx52.js";import"./iconbase.esm-CycjtHYb.js";import"./portal.esm-ZPKbRoAC.js";import"./ripple.esm-BKB6VsNq.js";import"./index-B-zkmOMm.js";import"./inputtext.esm-DpYC840t.js";import"./tooltip.esm-B48pQ4fn.js";import"./index-CFd3A8tf.js";import"./index.esm-D2Mau25a.js";import"./sidebar.esm-C28GSpQQ.js";import"./NoData-Bx3RbsXE.js";import"./Dropdown-VWJDfQuR.js";import"./icon-ntwga0O_.js";import"./Note-ClESBGl_.js";import"./avatar.esm-CbNomGyH.js";import"./index.esm-DxvocRbz.js";const oe=i.createContext();function G(){return i.useContext(oe)}const ae=({children:o,wallets:a,...s})=>{const[t,c]=i.useState({from:{converted:0,input:""},limit:{converted:0,input:""},to:{converted:0,input:""},time:{converted:0,input:""}}),[v,p]=i.useState({from:{fiat:{symbol:"$",rate:0},rate:0},to:{fiat:{symbol:"$",rate:0},rate:0}}),[m,l]=i.useState({from:a.from,to:a.to}),{getRate:h,rates:y}=ge();i.useEffect(()=>{v&&p(T.getRate("from","to"))},[y,m]);const T={getKey(r){return r=="from"?"to":"from"},getField(r){return t[r]},setField(r,b){c(u=>{if(r=="from"||r=="to"){for(const j in u)if(Object.prototype.hasOwnProperty.call(u,j)){const P=u[j];P.current=!1}}return{...u,[r]:{...u[r],[r=="time"?"timer":"input"]:b,current:!0}}})},swap(){l({from:m.to,to:m.from})},setWallet(r,b){l(u=>({...u,[r]:b}))},convert(r,b){c(u=>({...u,[r]:{...u[r],converted:b}}))},getRate(...r){let b={},u=s.list.currencies.find(j=>j.default==1);return r.forEach(j=>{let P=j=="from"?"to":"from";b={...b,[j]:{fiat:{symbol:u.symbol,rate:h(m[j].curr.code,u.code)},rate:h(m[j].curr.code,m[P].curr.code)}}}),b},getCurrent(){return t.from.current?{...t.from,id:"from"}:t.limit.current?{...t.from,id:"from"}:t.to.current?{...t.to,id:"to"}:{...t.from,id:"from"}},snap(){return{amount:t.from.converted,toAmount:t.to.converted,limit:t.limit.converted||parseFloat(t.limit.input||"0"),rates:T.getRate("from","to"),expire:t.time.timer}}};return e.jsx(oe.Provider,{value:{...s,...T,wallets:m,rates:v,fields:t},children:o})},Z=({value:o=0,elementRef:a,className:s="",error:t="",min:c=1e-8,max:v=1e5,currencies:p,sx:m,id:l,wallet:h,limit:y,currType:T="*"})=>{const{list:r,setWallet:b,wallets:u,getKey:j,setField:P,fields:g,rates:L,convert:$,getCurrent:M,type:J,getField:B}=G(),[W,E]=i.useState(t),[D,A]=i.useState(o),[V,f]=i.useState(!0),N=a||i.useRef(),O=i.useRef(),R=l==="limit",_=j(h),[U,k]=i.useState(u[h]);i.useEffect(()=>{k(u[h])},[u]);function q(d,n=!1){const{rate:S}=L[_],{fiat:X}=L[h];if(O.current&&(O.current.innerText=X.symbol+w.round(w.times(X.rate,d),2)),n)return J==="limit"?R?void 0:y?w.round(w.times(g.limit.input||0,d),8):w.round(w.divide(w.times(1,g[_].converted),g.limit.input||g.limit.converted),8):w.round(w.times(S,d),8)}function ee(){const d=w.minus(L[_].rate,9e-7);A(d),P(l,d||0)}i.useEffect(()=>{l==="limit"&&ee()},[]),i.useEffect(()=>{const d=M();if(l!=="limit"&&q(D),d.id===l)return;if(l=="limit")return g.limit.converted?void 0:ee();const n=g[_],S=q(n.converted,!0);typeof S=="number"&&($(l,S),A(S))},[L]),i.useEffect(()=>{R&&(D>L.to.rate?E("The price you set to buy is higher than the current market price, which results in a loss."):E(""))},[g.limit]),i.useEffect(()=>{const d=M();if(l=="limit")d.id==l&&P("from",B("from").converted);else if(l!==d.id){let n=g[_].input,S=q(n,!0);if(typeof S!="number")return;$(l,S),A(S)}},[g[_].input]),i.useEffect(()=>{if(l=="from"){const d=u.from.all_balance.available,n=B("from").converted;!(n<c||n>v||n>d)&&W?E(""):g.from.input||g.to.input?(n<c&&E(`Amount is less than the minimum amount (${c})`),n>v&&E(`Amount is more than the maximum amount (${v})`),n>d&&E("Amount is more than current funds")):E("")}},[g.from.converted]);const me=d=>{let n=d.target.value.trim();n=="."?n="0.":n.startsWith("0")?n.length>1&&(n.charAt(1)==="0"?n="0":n.charAt(1)!=="."&&(n=n.substring(1))):n.startsWith("-")?n="0":n.startsWith(".")&&(n="0"+n),A(n||""),q(n),P(l,n||0),$(l,n)};function de(d){const n=r.wallets.find(S=>S.curr.id==d.id);k(n),b(h,n)}return e.jsxs(Y,{sx:m,className:H("relative",s),children:[e.jsx("div",{ref:N,className:H(I.main,{"!border-danger-300":W,"!p-0 !border-none":R}),children:e.jsxs(e.Fragment,{children:[e.jsx("input",{step:"any",value:Number.isNaN(D)?0:D,placeholder:"0",onChange:me,onBlur:()=>{var d;return(d=N.current)==null?void 0:d.classList.remove(I.focused)},onFocus:()=>{var d;(d=N.current)==null||d.classList.add(I.focused)},type:"number"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs(x,{onClick:()=>f(!1),lg:!0,className:"!font-medium z-50 !flex items-center gap-1 "+(p?"cursor-pointer":""),children:[e.jsxs("span",{className:"flex items-center gap-1",children:[C(u[h],e.jsx(Q,{width:"23px",curr:u[h].curr})),e.jsx("span",{children:u[h].curr.code})]}),p?e.jsx(xe,{}):""]}),e.jsxs("div",{className:"flex justify-between items-center w-full py-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:C(!R,e.jsxs(x,{noPad:!0,bright:!0,className:"gap-1",children:[e.jsx(be,{fontSize:"11px"}),e.jsx(x,{noPad:!0,bright:!0,sm:!0,ref:O,children:"$0.00"})]}),e.jsxs(x,{noPad:!0,sm:!0,className:"gap-1",children:["Market Price:",e.jsxs(x,{noPad:!0,sm:!0,children:[L[_].rate," ",u[h].curr.code]})]}))}),C(!R,e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(x,{noPad:!0,children:"Balance:"}),e.jsx(x,{noPad:!0,medium:!0,children:w.round(U.all_balance.available||0,8)}),e.jsx(x,{noPad:!0,medium:!0,sm:!0,children:U.curr.code})]}))]}),p?e.jsx(Ee,{by:T,set:f,value:U,hide:V,list:p,onChange:de}):""]}),C(y,e.jsxs("div",{className:"flex flex-col mt-3 gap-3",children:[e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(x,{md:!0,medium:!0,noPad:!0,className:"gap-1",children:["When 1 ",e.jsx("b",{children:u[j(h)].curr.code})," is worth"]}),e.jsx(Z,{value:0,elementRef:N,id:"limit",wallet:h})]})]}))]})}),e.jsx(ie,{className:"text-danger-700 !font-medium",variant:"small",children:W})]})},Ee=({list:o,onChange:a,hide:s,set:t,by:c})=>{const[v,p]=i.useState(o.filter(m=>c=="*"?!0:m.type==c));return e.jsx(le,{header:"Select Currency",className:I.currencyList,visible:!s,style:{height:"60vh"},onHide:()=>{s||t(!0)},children:e.jsxs("div",{className:"m-0",children:[e.jsx(we,{placeholder:"Search",onChange:m=>{const l=(m.target.value||"").toLowerCase();if(l.trim()=="")return p(o);p(o.filter(h=>h.code.toLowerCase().includes(l)||h.curr_name.toLowerCase().includes(l)))}}),e.jsx("div",{className:"mt-4 flex flex-col",children:v.map(m=>e.jsxs("div",{className:"flex px-3 py-2 rounded-md hover:bg-theme-button cursor-pointer items-center",onClick:()=>{t(!0),a(m)},children:[e.jsxs("div",{className:"flex gap-2 items-center mr-auto",children:[e.jsx(Q,{curr:m,width:"30px"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(x,{bold:!0,noPad:!0,children:m.code}),e.jsx(x,{noPad:!0,children:m.curr_name})]})]}),e.jsx(ye,{variant:"none",children:e.jsx(he,{})})]},m.id))})]})})},ce=({order:o,exchange:a,title:s})=>{var h,y;const{list:t,wallets:c,type:v,rates:p,swap:m}=G(),l=Ce();return i.useEffect(()=>{c.to.id==c.from.id&&l({closable:!0,severity:"error",summary:`Cannot exchange ${c.from.curr.code} with ${c.to.curr.code}`})},[c]),e.jsxs("div",{className:"flex flex-col relative gap-2",children:[e.jsx(ie,{size:"15px",className:"!font-medium",color:"rgb(var(--color-theme-emphasis))",children:s||"Amount"}),e.jsxs("div",{className:"flex relative flex-col gap-2",children:[e.jsx(Z,{sx:{order:o==-1?1:0},currencies:t.currencies,id:"from",wallet:"from",limit:v==="limit",currType:2}),e.jsx(Y,{order:o==-1?0:1,className:"h-full relative w-full flex",children:e.jsx(Y,{sx:{width:"45px",height:"45px",fontSize:"30px",zIndex:99,margin:"auto"},element:"div",onClick:m,className:"flex text-theme/55 items-center justify-center",children:C(a,e.jsx(Ne,{}),e.jsx(pe,{}))})}),e.jsx(Z,{sx:{order:o==-1?o:2},currencies:t.currencies,id:"to",currType:2,wallet:"to"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{noPad:!0,lg:!0,bold:!0,bright:!0,className:"flex gap-1",children:" Rate"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(x,{noPad:!0,children:["1 ",(h=c.from)==null?void 0:h.curr.code]}),e.jsx(ne,{}),e.jsxs(x,{bold:!0,noPad:!0,children:[" ",p&&p.from.rate," ",(y=c.to)==null?void 0:y.curr.code]})]})]})]})},jr=({auth:o,wallet:a,wallets:s,currencies:t})=>e.jsx(Fe,{user:o.user,title:"Swap",pusher:!0,desc:"Perform Fase and Seamless exchange",children:e.jsx(ve,{wallets:s,currencies:t,rates:!0,children:e.jsx("div",{className:H("mt-8",se.mainSwap),children:e.jsx("div",{className:se.swap,children:e.jsxs(Te,{children:[e.jsxs(te,{header:"Market",children:[e.jsx("div",{className:"mt-4"}),e.jsx(Le,{auth:o,wallet:a,wallets:s,currencies:t})]}),e.jsxs(te,{header:"Limit",children:[e.jsx("div",{className:"mt-4"}),e.jsx(De,{auth:o,wallet:a,wallets:s,currencies:t})]})]})})})})}),Le=({wallet:o,wallets:a,auth:s,currencies:t})=>{const[c,v]=i.useState(o),[p,m]=i.useState(a.find(l=>l.id!==c.id));return e.jsx(ae,{user:s.user,type:"instant",wallets:{from:c,to:p},list:{currencies:t,wallets:a},children:e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(ce,{exchange:!0,onChange:l=>console.log(l),order:0}),e.jsx(ue,{type:"instant"})]})})})},ue=({type:o})=>{var A,V;const{fields:a,wallets:s,snap:t}=G(),[c,v]=i.useState(!0),[p,m]=i.useState(0),[l,h]=i.useState(0),[y,T]=i.useState(!1),[r,b]=i.useState(),[u,j]=i.useState(!0),[P,g]=i.useState(6),{setData:L,processing:$,post:M,errors:J}=fe({});function B(f){var N;L({from:s.from.curr.id,to:s.to.curr.id,amount:f==null?void 0:f.amount,expire:(N=f==null?void 0:f.expire)==null?void 0:N.label,limitRate:f==null?void 0:f.limit,rate:f==null?void 0:f.rates.from.rate,type:o}),b(f)}i.useEffect(()=>{v(a.from.converted<=0||a.to.converted<=0)},[a.from.converted,a.to.converted]);const[W,E]=i.useState(),D=()=>{clearInterval(W),g(6)};return i.useEffect(()=>{D(),T(!u)},[u]),i.useEffect(()=>{if(y){W&&D();const f=s.from;if(!u){let N=parseFloat(f.curr.charges.exchange_charge);Number.isNaN(N)&&(N=0),f.curr.charges.exchange_charge_type=="%"&&(N=w.times((r==null?void 0:r.amount)||0,w.divide(N,100))),h(N),m(w.plus((r==null?void 0:r.amount)||0,N)),E(setInterval(()=>{g(R=>(R==1&&T(!1),R-1))},1e3))}}},[y]),i.useEffect(()=>{P===-2&&(D(),B(t()),T(!0))},[P]),i.useEffect(()=>{console.log(J)},[$]),e.jsxs(e.Fragment,{children:[e.jsx(K,{type:"button",onClick:()=>{c||(j(!1),B(t()))},className:H({"bg-primary-300 focus:!bg-primary-400 hover:bg-primary-400 cursor-not-allowed !text-white":c}),disabled:c,centered:!0,children:a.from.converted>0||a.to.converted>0?"Preview Conversion":"Enter an amount"}),e.jsx(le,{header:"Confirm",visible:!u,style:{height:"fit-content"},onHide:()=>{u||j(!0)},children:e.jsxs("div",{className:"m-0 flex flex-col gap-7",children:[e.jsxs("div",{className:"flex gap-3 flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Q,{height:"25px",width:"25px",size:"12px",curr:s.from.curr}),e.jsx(x,{bold:!0,noPad:!0,lg:!0,children:r==null?void 0:r.amount})]}),e.jsx(x,{noPad:!0,lg:!0,children:s.from.curr.code})]}),e.jsx(Se,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Q,{height:"25px",width:"25px",size:"10px",curr:s.to.curr}),e.jsx(x,{bold:!0,noPad:!0,lg:!0,children:r==null?void 0:r.toAmount})]}),e.jsx(x,{noPad:!0,lg:!0,children:s.to.curr.code})]})]}),e.jsxs("div",{children:[C(o=="limit",e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Expires in",value:e.jsx(F,{children:e.jsx(F,{children:(A=r==null?void 0:r.expire)==null?void 0:A.label})})}),e.jsx(z,{label:"Limit Rate",value:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(F,{children:["1 ",s.to.curr.code]}),"=",e.jsxs(F,{children:[r==null?void 0:r.limit," ",s.from.curr.code]})]})})]}),e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Rate",value:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(F,{children:["1 ",s.to.curr.code]}),"=",e.jsxs(F,{children:[(V=r==null?void 0:r.rates)==null?void 0:V.to.rate," ",s.from.curr.code]})]})}),e.jsx(z,{label:"inverse Rate",value:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(F,{children:["1 ",s.from.curr.code]}),"=",e.jsxs(F,{children:[r==null?void 0:r.rates.from.rate," ",s.to.curr.code]})]})})]})),e.jsx(z,{label:`Transaction Fees (${s.from.curr.charges.exchange_charge_type||"%"})`,value:e.jsx(F,{children:C(l>0,e.jsxs("span",{className:"flex gap-2 items-center",children:[e.jsx("b",{children:s.from.curr.charges.exchange_charge})," ",e.jsx(ne,{})," ",e.jsx("span",{children:l})]}),"No Fees")})}),C(o=="instant",e.jsx(z,{label:"Total",value:e.jsx(F,{children:p})}))]}),C(o=="instant",e.jsx("div",{className:"flex flex-col gap-2",children:C(parseFloat(s.from.all_balance.available)>=p,e.jsx(K,{disabled:!y,centered:!0,size:"normal",className:H({"opacity-60":!y}),onClick:f=>{f.preventDefault(),M(route("user.crypto.process.swap"))},bgColor:"primary",children:C(y,e.jsxs(e.Fragment,{children:["Convert ",P,"s"]}),"Refreshing...")}),e.jsxs("div",{className:"flex flex-col gap-2 !justify-start",children:[e.jsx(re,{className:"text-[.813em]",text:"Insufficient balance. Please fund your account.",severity:"error"}),e.jsx(K,{onClick:()=>b(t()),centered:!0,size:"normal",bgColor:"secondary",children:"Refresh Quote"})]}))})),C(o=="limit",e.jsx("div",{className:"flex flex-col gap-2",children:C(parseFloat(s.from.all_balance.available)>=p,e.jsx(K,{centered:!0,size:"normal",onClick:f=>{f.preventDefault(),M(route("user.crypto.process.swap"))},bgColor:"primary",children:"Ok"}),e.jsx("div",{className:"flex flex-col gap-2 !justify-start",children:e.jsx(re,{className:"text-[.813em]",text:"Insufficient balance. Please fund your account.",severity:"error"})}))}))]})})]})},z=({value:o,label:a})=>e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx(x,{md:!0,bright:!0,noPad:!0,children:a}),e.jsx("div",{className:"flex justify-end",children:o})]}),F=({children:o})=>e.jsx(x,{bold:!0,noPad:!0,children:o}),De=({wallet:o,wallets:a,auth:s,currencies:t})=>{const[c,v]=i.useState(o),[p,m]=i.useState(a.find(l=>l.id!==c.id));return e.jsx(ae,{user:s.user,type:"limit",wallets:{from:c,to:p},list:{currencies:t,wallets:a},children:e.jsxs("form",{className:"flex flex-col",children:[e.jsx(Re,{}),e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(ce,{exchange:!0,onChange:l=>console.log(l),order:0}),e.jsx(ue,{type:"limit"})]})]})})},Re=()=>{const{setField:o}=G(),a={value:"30d",label:"30 Days"},s=[{value:"1h",label:"1 Hour"},{value:"1d",label:"1 Day"},{value:"3d",label:"3 Days"},{value:"7d",label:"1 Days"},a];return i.useEffect(()=>{o("time",a)},[]),e.jsx(Pe,{className:"!bg-transparent !w-[130px] mb-2 ml-auto",trigger:"!h-[30px] !w-[30px] items-center flex !p-0 ml-2 hide-label",items:s,unique:"label",value:{value:"30d",label:"30 Days"},placeholder:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(je,{})," ",e.jsx(x,{noPad:!0,children:"Expires in"})]}),contentTemplate:t=>e.jsx(x,{noPad:!0,children:t.label}),menuItemTemplate:t=>e.jsx(x,{noPad:!0,children:t.label}),quick:!0,onSelect:t=>{const c=t.value;o("time",c)}})};export{jr as default};
