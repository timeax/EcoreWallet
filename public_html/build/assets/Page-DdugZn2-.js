import{r as t,j as e,y as U,W as M,a as V}from"./app-DPeqRPcX.js";import{A as H}from"./AuthenticatedLayout-BfKv6hjQ.js";import{B as k}from"./index-BuV88OsN.js";import{D as E}from"./Dropdown-VWJDfQuR.js";import{t as K,m as P,h as W}from"./settings-CNzXT97W.js";import{A as R}from"./avatar.esm-CbNomGyH.js";import{S as Y}from"./selectbutton.esm-VoZDkXIg.js";import{S as z}from"./Select-CJRs8Qvl.js";import{e as G}from"./index-DOPl3nEV.js";/* empty css                   */import{T as $,a as I}from"./tabview.esm-CgPeHz0w.js";import{D as q}from"./dialog.esm-B90dCpDH.js";import{T as S}from"./index-Dfq4-ipG.js";import{j as A,s as _,T as N}from"./index-BtqGtben.js";import{a as L,b as J}from"./AuthenticatedContext-YAhfpYvk.js";import{C as B}from"./TransactionDetail-Bbh_PUdh.js";import{_ as X}from"./index-QPOqPYTu.js";import{u as Z,g as ee,a as te}from"./useEnhancedEffect-AJ7aGHKx.js";import"./index-DAW83uBr.js";import"./iconBase-BE7iW8MJ.js";import"./index-B-zkmOMm.js";import"./icon-ntwga0O_.js";import"./Note-ClESBGl_.js";import"./StyledButton-ciDqVOpa.js";import"./IconButton-lyUs3Fyy.js";import"./componentbase.esm-CEyx904k.js";import"./tooltip.esm-B48pQ4fn.js";import"./portal.esm-ZPKbRoAC.js";import"./ripple.esm-BKB6VsNq.js";import"./iconbase.esm-CycjtHYb.js";import"./index.esm-DxvocRbz.js";import"./index.esm-UiDtkRAd.js";import"./objectWithoutPropertiesLoose-BwfzGx52.js";import"./inputtext.esm-DpYC840t.js";import"./index-CFd3A8tf.js";import"./index.esm-D2Mau25a.js";import"./sidebar.esm-C28GSpQQ.js";import"./NoData-Bx3RbsXE.js";import"./currency-format-BghgJM0E.js";import"./resolveProps-DGHzvMqG.js";function ae(a,n,s,i,u){const[r,p]=t.useState(()=>u&&s?s(a).matches:i?i(a).matches:n);return te(()=>{let l=!0;if(!s)return;const c=s(a),f=()=>{l&&p(c.matches)};return f(),c.addListener(f),()=>{l=!1,c.removeListener(f)}},[a,s]),r}const F=t.useSyncExternalStore;function se(a,n,s,i,u){const r=t.useCallback(()=>n,[n]),p=t.useMemo(()=>{if(u&&s)return()=>s(a).matches;if(i!==null){const{matches:d}=i(a);return()=>d}return r},[r,a,i,u,s]),[l,c]=t.useMemo(()=>{if(s===null)return[r,()=>()=>{}];const d=s(a);return[()=>d.matches,w=>(d.addListener(w),()=>{d.removeListener(w)})]},[r,s,a]);return F(c,l,p)}function re(a,n={}){const s=Z(),i=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:u=!1,matchMedia:r=i?window.matchMedia:null,ssrMatchMedia:p=null,noSsr:l=!1}=ee({name:"MuiUseMediaQuery",props:n,theme:s});let c=a;return c=c.replace(/^@media( ?)/m,""),(F!==void 0?se:ae)(c,u,r,p,l)}const oe=({userEdit:a,avatarEdit:n})=>{const[s,i]=t.useState(),[u,r]=t.useState(),[p,l]=t.useState(""),c=J(),f=t.useRef(),d=L();t.useEffect(()=>{r(A(d.photo)),l(d.username)},[]);const{data:w,errors:j,post:b,setData:y,wasSuccessful:v}=M({type:null,photo:d.photo,username:d.username});return t.useEffect(()=>{v&&(a[1](!1),n[1](!1),c.success(`Successfully updated ${w.type}`))},[v]),t.useEffect(()=>{j.photo&&c.error(j.photo)},[j.photo]),e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Edit username",state:a,children:[e.jsx(S,{errorText:j.username,name:"username",label:"Edit Username",value:p||"",onChange:h=>{const o=h.target.value;y({type:"username",username:o}),l(h.target.value)}}),h=>{b(route("user.profile.update.general"))}]}),e.jsxs(C,{title:"Upload avatar",state:n,children:[e.jsxs("div",{className:"col-span-6 ml-2 sm:col-span-4 md:mr-3",children:[e.jsx("input",{type:"file",className:"hidden",ref:f,onChange:h=>{var x,T,g,m,D;i((T=(x=f.current)==null?void 0:x.files)==null?void 0:T[0].name),y({photo:(g=h.target.files)==null?void 0:g[0],type:"avatar"});const o=new FileReader;o.onload=O=>{var Q;r((Q=O.target)==null?void 0:Q.result)},o.readAsDataURL((D=(m=f.current)==null?void 0:m.files)==null?void 0:D[0])}}),e.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2 text-center",htmlFor:"photo",children:["Profile Photo ",e.jsx("span",{className:"text-red-600",children:" "})]}),e.jsxs("div",{className:"text-center flex flex-col items-center justify-center",children:[e.jsx(R,{icon:_(u,e.jsx("img",{src:u||A(d.photo)}),e.jsx(G,{})),size:"large",shape:"circle",className:"avatar"}),e.jsx("button",{onClick:()=>{var h;return(h=f.current)==null?void 0:h.click()},type:"button",className:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:text-gray-500 focus:outline-none focus:border-blue-400 focus:shadow-outline-blue active:text-gray-800 active:bg-gray-50 transition ease-in-out duration-150 mt-2 ml-3",children:"Select New Photo"})]})]}),h=>{b(route("user.profile.update.general"))}]})]})},ne=t.createContext(null);function qe({auth:a,currencies:n,languages:s,settings:i,gs:u,...r}){return e.jsx(H,{user:a.user,title:"Settings",...r,header:e.jsxs(E,{className:"hidden",onSelect:p=>{window.axios.post(route("api.webhook"))},children:[e.jsx(E.Trigger,{children:e.jsx(k,{size:"sm",variant:"outlined",bgColor:"success",children:a.user.email})}),e.jsxs(E.Content,{children:[e.jsx(E.Link,{value:"paid",children:"Paid"}),e.jsx(E.Link,{value:"process",children:"Process"}),e.jsx(E.Link,{value:"failed",children:"Failed"})]})]}),pusher:!0,children:e.jsx(ne.Provider,{value:{user:a.user,currencies:n,languages:s,settings:i},children:e.jsxs($,{children:[e.jsx(I,{header:"Preference",children:e.jsx(ie,{currencies:n,languages:s})}),e.jsx(I,{header:"Security",children:e.jsx(le,{user:a.user})})]})})})}const ie=({currencies:a,languages:n})=>{const s=re("(max-width: 500px)"),i=t.useState(!1),u=t.useState(!1),[r,p]=t.useState(),[l,c]=t.useState(),[f,d]=t.useState("light"),[w,j]=t.useState(),[b,y]=t.useState(),v=L();t.useEffect(()=>{j(n.find(o=>o.id==v.lang)||n.find(o=>o.is_default==1)),p(v.account_no),c(a.find(o=>o.id==v.currency)||a.find(o=>o.default==1)),d(localStorage.getItem("theme")||"light"),y(A(v.photo))},[]);const h={profile:[[{title:"Username ",info:"Set up your username or preferred nickname. It is advisable to avoid using your real name "},{isText:!1,data:""},{text:"Edit",action(){i[1](!0)}}],[{title:"Avatar",info:"Set up a preferred Avatar for your account"},{isText:!1,data:e.jsx(R,{icon:_(b,e.jsx("img",{src:b}),e.jsx(G,{})),size:"normal",shape:"circle",className:"avatar"})},{text:"Edit",action:()=>u[1](!0)}],[{title:"Account Number",info:r?"This will be used to recieve crypto from other Ecore users.":"Complete your KYC to get an account number"},{isText:!1,data:""},{text:e.jsx(B,{className:"tracking-widest",value:r}),action:null}]],general:[[{title:"Language ",info:""},{isText:!1,data:""},{text:e.jsx(z,{value:w||n.find(o=>o.is_default==1),items:n,label:"code",menu:"language",menuGap:8,gap:32,unique:"id",onSelect:o=>{const x=o.value;x&&U.post(route("user.profile.update.general",{lang:x.id,type:"lang"}))},quick:!0,marker:"dot",content:"!w-fit"}),action:null}],[{title:"Currency",info:""},{isText:!1,data:""},{text:e.jsx(z,{items:a,value:l||a.find(o=>o.default==1),label:"code",menu:"code",onSelect:o=>{const x=o.value;x&&U.post(route("user.profile.update.general",{currency:x.id,type:"currency"}))},quick:!0,marker:"dot",content:"!w-fit",gap:20,menuGap:10,unique:"id"}),action:null}],[{title:"Theme ",info:""},{isText:!1,data:""},{text:e.jsx(Y,{className:"items-center",value:f,options:K,onChange:o=>{d(o.value),localStorage.setItem("theme",o.value)},optionLabel:"icon",optionValue:"name"}),action:null}]]};return e.jsxs("div",{className:"pg-parent",children:[e.jsx(oe,{userEdit:i,avatarEdit:u}),P({header:"Profile",body:[...h.profile],isPhone:s}),P({header:"General",body:[...h.general],isPhone:!1})]})},C=({save:a="Save",children:[n,s],title:i,state:[u,r]})=>e.jsx(q,{className:"modal",footer:p=>e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx(k,{centered:!0,className:"grow",onClick:()=>r(!1),size:"normal",bgColor:"warning",shape:"pill",children:"Cancel"}),_(s,e.jsx(k,{centered:!0,className:"grow",shape:"pill",onClick:()=>s==null?void 0:s(p),size:"normal",children:a}))]}),header:i,visible:u,onHide:()=>{u&&r(!1)},children:n}),le=({user:a})=>{const n=t.useState(!1),s=t.useState(!1),i=t.useState(!1),u=t.useState(!1),r=t.useState(!1),p=t.useState(!1),l=function(d){return()=>d[1](!0)},c={twofa:[[{title:"Email Address ",info:"Changing your email will log you out from all your devices for verification purposes."},{isText:!1,data:W(a.email)},{text:"Edit",action:l(n)}],[{title:"Login Password",info:"Changing password would require relogging to your account"},{isText:!1,data:"****"},{text:"Edit",action:l(s)}],[{title:"Authenticator App (2FA)",info:"Set up and manage 2Factor authentication on your account"},{isText:!1,data:""},{text:"Manage",action:l(i)}]],manage:[[{title:"Disactivate Account",info:""},{isText:!1,data:""},{text:"Disable",action:l(r)}]]};return e.jsxs("div",{className:"pg-parent",children:[e.jsx(ce,{email:n,password:s,auth:i,disable:r,close:p,activity:u}),P({header:"Authentication",body:[...c.twofa]}),P({header:"Account Management",body:[...c.manage]})]})},ce=({email:a,password:n,auth:s,disable:i,activity:u})=>{const[r,p]=t.useState(),[l,c]=t.useState(),[f,d]=t.useState(),[w,j]=t.useState(),{data:b,setData:y,put:v,patch:h,post:o,errors:x,wasSuccessful:T}=M(),g=L();return t.useEffect(()=>{p(g.email)},[]),t.useEffect(()=>{T&&(a[1](!1),n[1](!1))},[T]),t.useEffect(()=>{y({name:g.name,email:r})},[r]),t.useEffect(()=>{y({email:g.email,password:l,new_password_confirmation:w,new_password:f})},[l,w,f]),e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Edit Email",state:a,children:[e.jsx(S,{name:"email",value:r,onChange:m=>p(m.target.value),type:"email",label:"Edit Email"}),m=>{h(route("user.profile.update"))}]}),e.jsxs(C,{title:"Edit Password",state:n,children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(S,{errorText:x.password,value:l,onChange:m=>c(m.target.value),type:"password",name:"password",label:"Old password"}),e.jsx(S,{errorText:x.new_password,value:f,onChange:m=>d(m.target.value),type:"password",name:"newpassword",label:"New password"}),e.jsx(S,{errorText:x.new_password_confirmation,value:w,onChange:m=>j(m.target.value),type:"password",name:"confirmpassword",label:"Confirm new password"}),e.jsx(N,{noPad:!0,sm:!0,className:"text-primary-700 underline",children:e.jsx(V,{href:route("user.forgot-password"),children:"forgot password?"})})]}),m=>{v(route("user.password.update"))}]}),e.jsxs(C,{title:"Manage Two-factor authenticator",state:s,children:[_(g.two_fa&&g.two_fa_code,e.jsxs("div",{className:"flex flex-col justify-center items-center gap-3",children:[e.jsxs(N,{noPad:!0,sm:!0,bright:!0,normal:!0,className:"!block text-center",children:["Scan the QRcode or copy the code to your authenticator app, preferrably",e.jsx("b",{children:" Google authenticator"})]}),e.jsx(N,{normal:!0,className:"p-1 !px-3 border rounded-md",lg:!0,children:e.jsx(B,{value:g.two_fa})}),e.jsx(X,{value:g.two_fa_code||"",size:150}),e.jsx(S,{name:"code",type:"text",onChange:m=>y({code:m.target.value}),label:"Enter code from authenticator"})]}),e.jsx(N,{lg:!0,noPad:!0,children:"Authenticator has been linked"})),g.two_fa&&g.two_fa_code?m=>{o(route("user.two.step.verify"))}:void 0]}),e.jsxs(C,{title:"Are you sure?",save:"Disable",state:i,children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(S,{errorText:x.password,onChange:m=>c(m.target.value),name:"phone",type:"password",label:"Enter password"})}),m=>{o(route("user.profile.destroy"))}]})]})};export{qe as default};
